<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CubeEngine â€” ì—”ì§„ ì„¤ì •</title>
<style>
:root {
  --bg:#0d1117; --card:#161b22; --border:#30363d;
  --green:#00ff88; --blue:#58a6ff; --yellow:#f5a623;
  --red:#ff6b6b; --purple:#a371f7; --text:#e6edf3; --sub:#8b949e;
  --orange:#f0883e;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,'Segoe UI',monospace;background:var(--bg);color:var(--text);padding:12px;min-height:100vh}

/* í—¤ë” */
.hd{display:flex;justify-content:space-between;align-items:center;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px 18px;margin-bottom:12px}
.hd-title{font-size:16px;font-weight:bold;color:var(--green)}
.hd-sub{font-size:11px;color:var(--sub)}
.back-btn{background:#21262d;color:var(--blue);border:1px solid var(--border);padding:7px 14px;border-radius:8px;font-size:12px;font-weight:bold;text-decoration:none;cursor:pointer}

/* íƒ­ */
.tabs{display:flex;gap:4px;margin-bottom:12px;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:4px}
.tab{flex:1;padding:8px;border:none;border-radius:7px;font-size:12px;font-weight:bold;cursor:pointer;background:transparent;color:var(--sub);transition:all .15s}
.tab.active{background:#238636;color:#fff}
.tab-panel{display:none}
.tab-panel.active{display:block}

/* ì¹´ë“œ */
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:10px}
.card-ttl{font-size:11px;font-weight:bold;color:var(--sub);text-transform:uppercase;letter-spacing:.08em;margin-bottom:12px;display:flex;align-items:center;gap:6px}
.dot{width:8px;height:8px;border-radius:50%}
.dg{background:var(--green)}.db{background:var(--blue)}.dy{background:var(--yellow)}.dp{background:var(--purple)}.dr{background:var(--red)}.do{background:var(--orange)}

/* ì„¤ì • í–‰ */
.opt{display:flex;align-items:center;gap:12px;margin-bottom:14px;flex-wrap:wrap}
.opt-label{font-size:12px;color:var(--text);min-width:130px;flex-shrink:0}
.opt-desc{font-size:10px;color:var(--sub);margin-top:2px}
.opt-info{flex:1;min-width:200px}
.opt-val{font-size:13px;font-weight:bold;color:var(--yellow);min-width:50px;text-align:right}

/* ìŠ¬ë¼ì´ë” */
input[type=range]{width:100%;-webkit-appearance:none;height:4px;border-radius:2px;background:#30363d;outline:none}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:var(--green);border:2px solid #0d1117;box-shadow:0 0 5px var(--green);cursor:pointer}
input[type=range].blue::-webkit-slider-thumb{background:var(--blue);box-shadow:0 0 5px var(--blue)}
input[type=range].purple::-webkit-slider-thumb{background:var(--purple);box-shadow:0 0 5px var(--purple)}
input[type=range].yellow::-webkit-slider-thumb{background:var(--yellow);box-shadow:0 0 5px var(--yellow)}
input[type=range].orange::-webkit-slider-thumb{background:var(--orange);box-shadow:0 0 5px var(--orange)}

/* ìˆ«ì ì…ë ¥ */
input[type=number]{background:#21262d;border:1px solid var(--border);border-radius:6px;color:var(--text);padding:5px 8px;font-size:13px;width:80px;text-align:center}
input[type=number]:focus{outline:none;border-color:var(--green)}

/* í”„ë¦¬ì…‹ ë²„íŠ¼ */
.preset-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px;margin-bottom:4px}
.preset-btn{padding:10px 8px;border:1px solid var(--border);border-radius:8px;background:#21262d;color:var(--text);font-size:11px;font-weight:bold;cursor:pointer;text-align:center;transition:all .15s}
.preset-btn:hover{border-color:var(--blue);color:var(--blue)}
.preset-btn.active{border-color:var(--green);color:var(--green);background:#0d2818}
.preset-name{font-size:13px;margin-bottom:2px}
.preset-sub{font-size:10px;color:var(--sub);font-weight:normal}

/* Firebase ì„¤ì • */
.fb-input{width:100%;background:#21262d;border:1px solid var(--border);border-radius:6px;color:var(--text);padding:8px 10px;font-size:12px;font-family:monospace}
.fb-input:focus{outline:none;border-color:var(--blue)}

/* ë²„íŠ¼ */
.btn-row{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
.btn{padding:11px 18px;border:none;border-radius:8px;font-size:13px;font-weight:bold;cursor:pointer;transition:all .15s}
.btn:active{transform:scale(.97)}
.btn:disabled{opacity:.4;cursor:not-allowed}
.btn-green{background:#238636;color:#fff}
.btn-green:hover{background:#2ea043}
.btn-blue{background:#1f4068;color:var(--blue);border:1px solid var(--blue)}
.btn-blue:hover{background:#1a3558}
.btn-red{background:#6e1414;color:#fff}
.btn-red:hover{background:#b91c1c}
.btn-gray{background:#21262d;color:var(--text);border:1px solid var(--border)}

/* ê²°ê³¼ ë¡œê·¸ */
.log{background:#0d1117;border-radius:8px;padding:10px;font-size:11px;font-family:monospace;max-height:180px;overflow-y:auto;border:1px solid var(--border)}
.log-ts{color:var(--green)}.log-ti{color:var(--blue)}.log-tw{color:var(--yellow)}.log-te{color:var(--red)}

/* ìƒíƒœ ë°°ì§€ */
.badge{display:inline-block;padding:3px 8px;border-radius:12px;font-size:10px;font-weight:bold}
.badge-ok{background:#0d2818;color:var(--green);border:1px solid var(--green)}
.badge-err{background:#2d1414;color:var(--red);border:1px solid var(--red)}
.badge-warn{background:#2d2000;color:var(--yellow);border:1px solid var(--yellow)}

/* í˜„ì¬ ê°’ ìš”ì•½ */
.summary-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
.summary-item{background:#0d1117;border-radius:8px;padding:8px;text-align:center}
.summary-val{font-size:16px;font-weight:bold;color:var(--yellow)}
.summary-key{font-size:10px;color:var(--sub);margin-top:2px}

/* ì„¹ì…˜ êµ¬ë¶„ì„  */
.divider{border:none;border-top:1px solid var(--border);margin:14px 0}

/* toggle */
.toggle-wrap{display:flex;align-items:center;gap:8px}
.toggle{position:relative;width:40px;height:22px;flex-shrink:0}
.toggle input{opacity:0;width:0;height:0}
.toggle-slider{position:absolute;inset:0;background:#30363d;border-radius:11px;cursor:pointer;transition:.2s}
.toggle-slider:before{content:'';position:absolute;width:16px;height:16px;left:3px;top:3px;background:#fff;border-radius:50%;transition:.2s}
.toggle input:checked + .toggle-slider{background:var(--green)}
.toggle input:checked + .toggle-slider:before{transform:translateX(18px)}

/* ì½”ë“œ ë°•ìŠ¤ */
.codebox{background:#0d1117;border:1px solid var(--border);border-radius:8px;padding:12px;font-family:monospace;font-size:11px;color:#79c0ff;overflow-x:auto;white-space:pre;margin-top:8px}
</style>
</head>
<body>

<!-- í—¤ë” -->
<div class="hd">
  <div>
    <div class="hd-title">âš™ï¸ CubeEngine ì„¤ì •</div>
    <div class="hd-sub">ì—”ì§„ íŒŒë¼ë¯¸í„° Â· Firebase ê²½ë¡œ Â· í•™ìŠµ ì‹¤í–‰</div>
  </div>
  <a href="index.html" class="back-btn">â† ëŒ€ì‹œë³´ë“œ</a>
</div>

<!-- íƒ­ -->
<div class="tabs">
  <button class="tab active" onclick="switchTab('preset')">ğŸ› í”„ë¦¬ì…‹</button>
  <button class="tab" onclick="switchTab('learning')">ğŸ§  í•™ìŠµ íŒŒë¼ë¯¸í„°</button>
  <button class="tab" onclick="switchTab('firebase')">ğŸ”¥ Firebase</button>
  <button class="tab" onclick="switchTab('code')">ğŸ“‹ ì½”ë“œ ìƒì„±</button>
</div>

<!-- â•â• íƒ­1: í”„ë¦¬ì…‹ â•â• -->
<div id="tab-preset" class="tab-panel active">
  <div class="card">
    <div class="card-ttl"><div class="dot dg"></div>ê²Œì„ ìœ í˜• ì„ íƒ</div>
    <div class="preset-grid" id="presetGrid"></div>
    <div style="margin-top:10px;font-size:11px;color:var(--sub)" id="presetDesc">í”„ë¦¬ì…‹ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ê²Œì„ì— ìµœì í™”ëœ ê¸°ë³¸ê°’ì´ ìë™ ì ìš©ë©ë‹ˆë‹¤.</div>
  </div>
  <div class="card">
    <div class="card-ttl"><div class="dot db"></div>í˜„ì¬ ì„¤ì • ìš”ì•½</div>
    <div class="summary-grid">
      <div class="summary-item"><div class="summary-val" id="sumItems">45</div><div class="summary-key">ë²ˆí˜¸ ë²”ìœ„</div></div>
      <div class="summary-item"><div class="summary-val" id="sumPick">6</div><div class="summary-key">ì„ íƒ ê°œìˆ˜</div></div>
      <div class="summary-item"><div class="summary-val" id="sumRounds">50</div><div class="summary-key">ë¼ìš´ë“œ</div></div>
      <div class="summary-item"><div class="summary-val" id="sumPool">2500</div><div class="summary-key">Pool Size</div></div>
      <div class="summary-item"><div class="summary-val" id="sumTopN">5</div><div class="summary-key">Top N</div></div>
      <div class="summary-item"><div class="summary-val" id="sumEvolve">80ms</div><div class="summary-key">ì§„í™” ì‹œê°„</div></div>
    </div>
  </div>
</div>

<!-- â•â• íƒ­2: í•™ìŠµ íŒŒë¼ë¯¸í„° â•â• -->
<div id="tab-learning" class="tab-panel">

  <div class="card">
    <div class="card-ttl"><div class="dot dg"></div>ê¸°ë³¸ ì„¤ì •</div>

    <div class="opt">
      <div class="opt-info">
        <div class="opt-label">ë²ˆí˜¸ ë²”ìœ„ (items)</div>
        <div class="opt-desc">1~N ë²”ìœ„ì—ì„œ ë²ˆí˜¸ ì¶”ì¶œ. ë¡œë˜6/45=45, íŒŒì›Œë³¼=69</div>
        <input type="range" id="s_items" min="10" max="90" value="45" class="blue" oninput="syncOpt('items',this.value)">
      </div>
      <div class="opt-val"><span id="v_items">45</span></div>
    </div>

    <div class="opt">
      <div class="opt-info">
        <div class="opt-label">ì„ íƒ ê°œìˆ˜ (pick)</div>
        <div class="opt-desc">ìµœì¢… ì¡°í•©ì— í¬í•¨ë  ë²ˆí˜¸ ìˆ˜</div>
        <input type="range" id="s_pick" min="1" max="25" value="6" class="blue" oninput="syncOpt('pick',this.value)">
      </div>
      <div class="opt-val"><span id="v_pick">6</span></div>
    </div>

    <hr class="divider">

    <div class="opt">
      <div class="opt-info">
        <div class="opt-label">ë¼ìš´ë“œ ìˆ˜ (rounds)</div>
        <div class="opt-desc">ë§ì„ìˆ˜ë¡ ì •ë°€í•˜ì§€ë§Œ ëŠë¦¼. turbo=15, lotto645=50</div>
        <input type="range" id="s_rounds" min="5" max="100" value="50" oninput="syncOpt('rounds',this.value)">
      </div>
      <div class="opt-val"><span id="v_rounds">50</span></div>
    </div>

    <div class="opt">
      <div class="opt-info">
        <div class="opt-label">Pool Size</div>
        <div class="opt-desc">ë¼ìš´ë“œë‹¹ ìƒì„± ì¡°í•© ìˆ˜. í´ìˆ˜ë¡ ë‹¤ì–‘í•˜ì§€ë§Œ ëŠë¦¼</div>
        <input type="range" id="s_poolSize" min="100" max="5000" step="100" value="2500" class="blue" oninput="syncOpt('poolSize',this.value)">
      </div>
      <div class="opt-val"><span id="v_poolSize">2500</span></div>
    </div>

    <div class="opt">
      <div class="opt-info">
        <div class="opt-label">Top N ê²°ê³¼</div>
        <div class="opt-desc">ë°˜í™˜í•  ìµœê³  ì¡°í•© ìˆ˜</div>
        <input type="range" id="s_topN" min="1" max="20" value="5" class="purple" oninput="syncOpt('topN',this.value)">
      </div>
      <div class="opt-val"><span id="v_topN">5</span></div>
    </div>

    <div class="opt">
      <div class="opt-info">
        <div class="opt-label">ì§„í™” ì‹œê°„ (evolveTime)</div>
        <div class="opt-desc">ê°œë³„ ë²ˆí˜¸ ì§„í™” ë°˜ë³µ ms. í´ìˆ˜ë¡ ì •ë°€</div>
        <input type="range" id="s_evolveTime" min="10" max="300" step="10" value="80" class="orange" oninput="syncOpt('evolveTime',this.value)">
      </div>
      <div class="opt-val"><span id="v_evolveTime">80</span>ms</div>
    </div>
  </div>

  <div class="card">
    <div class="card-ttl"><div class="dot dp"></div>í™•ë¥  ê°€ì¤‘ì¹˜</div>

    <div class="opt">
      <div class="opt-info">
        <div class="opt-label">StatCache ê°€ì¤‘ì¹˜ (statWeight)</div>
        <div class="opt-desc">í†µê³„ ê¸°ë°˜ í™•ë¥  ë¹„ì¤‘. ë†’ì„ìˆ˜ë¡ ê³¼ê±° ë¹ˆë„ ì˜ì¡´â†‘ (0~1)</div>
        <input type="range" id="s_statWeight" min="0" max="100" value="15" class="purple" oninput="syncOpt('statWeight',this.value/100,true)">
      </div>
      <div class="opt-val"><span id="v_statWeight">0.15</span></div>
    </div>

    <div class="opt">
      <div class="opt-info">
        <div class="opt-label">ìµœê·¼ íšŒì°¨ ìœˆë„ìš° (recentWindow)</div>
        <div class="opt-desc">ìµœê·¼ NíšŒì°¨ ë¹ˆë„ ê³„ì‚° ë²”ìœ„</div>
        <input type="range" id="s_recentWindow" min="5" max="100" value="30" class="purple" oninput="syncOpt('recentWindow',this.value)">
      </div>
      <div class="opt-val"><span id="v_recentWindow">30</span>íšŒ</div>
    </div>

    <div class="opt">
      <div class="opt-info">
        <div class="opt-label">ë³´ë„ˆìŠ¤ ê°€ì¤‘ì¹˜ (bonusWeight)</div>
        <div class="opt-desc">ë³´ë„ˆìŠ¤ ë²ˆí˜¸ ë¹ˆë„ì˜ í™•ë¥  ê¸°ì—¬ ë¹„ì¤‘ (0~1)</div>
        <input type="range" id="s_bonusWeight" min="0" max="100" value="15" class="yellow" oninput="syncOpt('bonusWeight',this.value/100,true)">
      </div>
      <div class="opt-val"><span id="v_bonusWeight">0.15</span></div>
    </div>

    <div class="opt">
      <div class="opt-info">
        <div class="opt-label">ìƒ‰ìƒêµ¬ì—­ ê· í˜• (colorZoneWeight)</div>
        <div class="opt-desc">ë²ˆí˜¸ ìƒ‰ìƒ êµ¬ì—­ ê· í˜• ì ìˆ˜ ë¹„ì¤‘. 0ì´ë©´ ë¹„í™œì„±</div>
        <input type="range" id="s_colorZoneWeight" min="0" max="100" value="20" class="yellow" oninput="syncOpt('colorZoneWeight',this.value/100,true)">
      </div>
      <div class="opt-val"><span id="v_colorZoneWeight">0.20</span></div>
    </div>

    <div class="opt">
      <div class="opt-info">
        <div class="opt-label">Firebase í•™ìŠµ ì˜ì¡´ë„ (persistenceWeight)</div>
        <div class="opt-desc">ì´ì „ í•™ìŠµ(Firebase) ë°˜ì˜ ë¹„ì¤‘. ë‚®ì„ìˆ˜ë¡ ìƒˆ í•™ìŠµ ìš°ì„ </div>
        <input type="range" id="s_persistenceWeight" min="0" max="100" value="30" class="orange" oninput="syncOpt('persistenceWeight',this.value/100,true)">
      </div>
      <div class="opt-val"><span id="v_persistenceWeight">0.30</span></div>
    </div>
  </div>

  <div class="card">
    <div class="card-ttl"><div class="dot dy"></div>ë²ˆí˜¸ ë²”ìœ„ ì œí•œ (ì„ íƒ)</div>
    <div class="opt" style="flex-wrap:nowrap;gap:16px">
      <div>
        <div class="opt-label" style="min-width:auto">ì‹œì‘ ë²ˆí˜¸</div>
        <input type="number" id="s_rangeStart" min="1" max="45" value="1" onchange="syncOpt('rangeStart',this.value)">
      </div>
      <div style="font-size:18px;color:var(--sub);padding-top:18px">~</div>
      <div>
        <div class="opt-label" style="min-width:auto">ë ë²ˆí˜¸</div>
        <input type="number" id="s_rangeEnd" min="1" max="90" value="45" onchange="syncOpt('rangeEnd',this.value)">
      </div>
      <div style="font-size:11px;color:var(--sub);padding-top:18px">ë¹„ì›Œë‘ë©´ ì „ì²´ ë²”ìœ„ ì‚¬ìš©</div>
    </div>
  </div>
</div>

<!-- â•â• íƒ­3: Firebase â•â• -->
<div id="tab-firebase" class="tab-panel">
  <div class="card">
    <div class="card-ttl"><div class="dot dr"></div>Firebase í”„ë¡œì íŠ¸ ì„¤ì •</div>
    <div style="font-size:11px;color:var(--yellow);margin-bottom:12px;">âš ï¸ ë³¸ì¸ì˜ Firebase í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ë¡œë˜ ì›¹ê³¼ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ í•™ìŠµì´ ì™„ì „ ë…ë¦½ë©ë‹ˆë‹¤.</div>

    <div style="margin-bottom:10px">
      <div class="opt-label" style="margin-bottom:4px">Collection ê²½ë¡œ</div>
      <input class="fb-input" id="fb_col" value="lotto_history" placeholder="ex) lotto_history">
    </div>
    <div style="margin-bottom:10px">
      <div class="opt-label" style="margin-bottom:4px">í•™ìŠµ ìƒíƒœ ë¬¸ì„œ ID (shared_engine_state)</div>
      <input class="fb-input" id="fb_doc" value="shared_engine_state" placeholder="ex) shared_engine_state">
    </div>
    <div style="margin-bottom:10px">
      <div class="opt-label" style="margin-bottom:4px">ë°±í…ŒìŠ¤íŒ… ë¬¸ì„œ ID</div>
      <input class="fb-input" id="fb_btdoc" value="backtest_engine_state" placeholder="ex) backtest_engine_state">
    </div>
    <div style="margin-bottom:10px">
      <div class="opt-label" style="margin-bottom:4px">ë‹¹ì²¨ ë°ì´í„° ë¬¸ì„œ ê²½ë¡œ</div>
      <input class="fb-input" id="fb_history" value="lotto_history/lotto645_history" placeholder="ex) collection/document">
    </div>

    <hr class="divider">

    <div class="opt-label" style="margin-bottom:8px">í•™ìŠµ ì €ì¥ ì˜µì…˜</div>
    <div style="display:flex;flex-direction:column;gap:10px">
      <label class="toggle-wrap">
        <div class="toggle"><input type="checkbox" id="fb_merge" checked><div class="toggle-slider"></div></div>
        <span style="font-size:12px">ê°€ì¤‘ í‰ê·  ë³‘í•© (ëˆ„ì  í•™ìŠµ ë³´ì¡´)</span>
      </label>
      <label class="toggle-wrap">
        <div class="toggle"><input type="checkbox" id="fb_shared" checked><div class="toggle-slider"></div></div>
        <span style="font-size:12px">ë‹¤ë¥¸ ì‚¬ìš©ìì™€ í•™ìŠµ ê³µìœ </span>
      </label>
      <label class="toggle-wrap">
        <div class="toggle"><input type="checkbox" id="fb_backtest_sep" checked><div class="toggle-slider"></div></div>
        <span style="font-size:12px">ë°±í…ŒìŠ¤íŒ… ê²½ë¡œ ë¶„ë¦¬ (ê¶Œì¥)</span>
      </label>
    </div>
  </div>

  <div class="card">
    <div class="card-ttl"><div class="dot do"></div>ì—°ê²° ìƒíƒœ</div>
    <div id="fbStatus" style="font-size:12px;color:var(--sub)">ëŒ€ì‹œë³´ë“œì—ì„œ Firebase ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>
  </div>
</div>

<!-- â•â• íƒ­4: ì½”ë“œ ìƒì„± â•â• -->
<div id="tab-code" class="tab-panel">
  <div class="card">
    <div class="card-ttl"><div class="dot dg"></div>í˜„ì¬ ì„¤ì •ìœ¼ë¡œ ìƒì„±ëœ ì½”ë“œ</div>
    <div style="font-size:11px;color:var(--sub);margin-bottom:8px">ì´ ì½”ë“œë¥¼ ë³µì‚¬í•´ì„œ ìì‹ ì˜ ì•±ì— ë¶™ì—¬ë„£ìœ¼ë©´ í˜„ì¬ ì„¤ì •ì´ ê·¸ëŒ€ë¡œ ì ìš©ë©ë‹ˆë‹¤.</div>
    <div class="codebox" id="generatedCode">// ì„¤ì •ì„ ë³€ê²½í•˜ë©´ ìë™ìœ¼ë¡œ ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤</div>
    <div class="btn-row">
      <button class="btn btn-blue" onclick="copyCode()">ğŸ“‹ ì½”ë“œ ë³µì‚¬</button>
      <button class="btn btn-gray" onclick="generateCode()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
    </div>
  </div>

  <div class="card">
    <div class="card-ttl"><div class="dot db"></div>ê¸°ë³¸ ì‚¬ìš©ë²•</div>
    <div class="codebox">// 1. ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
&lt;script src="cube-engine.js"&gt;&lt;/script&gt;

// 2. ê¸°ë³¸ ì‚¬ìš© (withPreset)
const result = await CubeEngine.generate(
  CubeEngine.withPreset('lotto645', {
    history: ë‹¹ì²¨ë²ˆí˜¸_2Dë°°ì—´,
    bonusHistory: ë³´ë„ˆìŠ¤ë²ˆí˜¸_ë°°ì—´,
    topN: 5
  })
);

// 3. ê²°ê³¼
console.log(result.results);  // ì¶”ì²œ ì¡°í•© ë°°ì—´
console.log(result.probMap);  // ë²ˆí˜¸ë³„ í™•ë¥ ë§µ
console.log(result.scores);   // ì¡°í•©ë³„ ì ìˆ˜</div>
  </div>
</div>

<!-- â•â• í•˜ë‹¨ ì‹¤í–‰ íŒ¨ë„ â•â• -->
<div class="card" style="margin-top:4px;border-color:#238636">
  <div class="card-ttl"><div class="dot dg"></div>í…ŒìŠ¤íŠ¸ í•™ìŠµ ì‹¤í–‰</div>
  <div style="font-size:11px;color:var(--sub);margin-bottom:10px">í˜„ì¬ ì„¤ì •ìœ¼ë¡œ ì—”ì§„ì„ ì‹¤í–‰í•´ ê²°ê³¼ë¥¼ ë¯¸ë¦¬ í™•ì¸í•©ë‹ˆë‹¤. (Firebase ì—°ë™ ì—†ì´ ë¡œì»¬ ì‹¤í–‰)</div>
  <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap">
    <div style="font-size:12px;color:var(--sub)">ìƒíƒœ:</div>
    <span id="runStatus" class="badge badge-warn">ëŒ€ê¸° ì¤‘</span>
    <div style="font-size:12px;color:var(--sub);margin-left:8px">Best Score:</div>
    <span id="runBest" style="color:var(--yellow);font-weight:bold;font-size:13px">-</span>
  </div>
  <div style="background:#21262d;border-radius:4px;height:6px;margin-bottom:10px;overflow:hidden">
    <div id="runBar" style="height:100%;background:linear-gradient(90deg,var(--green),var(--blue));width:0%;transition:width .3s;border-radius:4px"></div>
  </div>
  <div class="btn-row">
    <button class="btn btn-green" id="btnTest" onclick="runTest()">â–¶ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
    <button class="btn btn-gray" onclick="saveSettings()">ğŸ’¾ ì„¤ì • ì €ì¥ (LocalStorage)</button>
    <button class="btn btn-gray" onclick="loadSettings()">ğŸ“‚ ì €ì¥ëœ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <button class="btn btn-red" onclick="resetSettings()">â†º ê¸°ë³¸ê°’ ì´ˆê¸°í™”</button>
  </div>
  <div class="log" id="runLog" style="margin-top:10px"></div>
</div>

<!-- Firebase & CubeEngine -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="cube-engine.js"></script>

<script>
// â•â• ìƒíƒœ â•â•
var CFG = {
  items: 45, pick: 6, rounds: 50, poolSize: 2500, topN: 5,
  evolveTime: 80, statWeight: 0.15, recentWindow: 30,
  bonusWeight: 0.15, colorZoneWeight: 0.20, persistenceWeight: 0.30,
  rangeStart: null, rangeEnd: null
};

var PRESETS = {
  'lotto645'    : { items:45, pick:6, rounds:50, poolSize:2500, evolveTime:80,  topN:5,  label:'ğŸ‡°ğŸ‡· ë¡œë˜ 6/45',     sub:'í•œêµ­' },
  'lotto638'    : { items:38, pick:6, rounds:50, poolSize:2500, evolveTime:80,  topN:5,  label:'ğŸ± ë¡œë˜ 6/38',     sub:'ì¼ë¶€ ì§€ì—­' },
  'powerball'   : { items:69, pick:5, rounds:60, poolSize:3000, evolveTime:100, topN:5,  label:'ğŸ‡ºğŸ‡¸ íŒŒì›Œë³¼',       sub:'ë¯¸êµ­' },
  'megamillions': { items:70, pick:5, rounds:60, poolSize:3000, evolveTime:100, topN:5,  label:'ğŸ’° ë©”ê°€ë°€ë¦¬ì–¸',    sub:'ë¯¸êµ­' },
  'euromillions': { items:50, pick:5, rounds:55, poolSize:2800, evolveTime:90,  topN:5,  label:'ğŸ‡ªğŸ‡º ìœ ë¡œë°€ë¦¬ì–¸',   sub:'ìœ ëŸ½' },
  'keno'        : { items:80, pick:20, rounds:40, poolSize:3500, evolveTime:150, topN:3, label:'ğŸ° ì¼€ë…¸',          sub:'80ì¤‘ 20' },
  'turbo'       : { items:45, pick:6, rounds:15,  poolSize:800,  evolveTime:40,  topN:5,  label:'âš¡ í„°ë³´ (ë¹ ë¦„)',  sub:'ê²½ëŸ‰ ëª¨ë“œ' },
  'custom'      : { items:45, pick:6, rounds:50,  poolSize:2500, evolveTime:80,  topN:5,  label:'ğŸ”§ ì»¤ìŠ¤í…€',       sub:'ì§ì ‘ ì„¤ì •' }
};

var currentPreset = 'lotto645';

// â•â• íƒ­ ì „í™˜ â•â•
function switchTab(name) {
  document.querySelectorAll('.tab').forEach(function(t,i){
    var names = ['preset','learning','firebase','code'];
    t.className = 'tab' + (names[i]===name?' active':'');
  });
  document.querySelectorAll('.tab-panel').forEach(function(p){
    p.className = 'tab-panel' + (p.id==='tab-'+name?' active':'');
  });
  if(name==='code') generateCode();
}

// â•â• í”„ë¦¬ì…‹ ë Œë” â•â•
function renderPresets() {
  var g = document.getElementById('presetGrid');
  g.innerHTML = '';
  Object.keys(PRESETS).forEach(function(key) {
    var p = PRESETS[key];
    var btn = document.createElement('div');
    btn.className = 'preset-btn' + (key===currentPreset?' active':'');
    btn.innerHTML = '<div class="preset-name">'+p.label+'</div><div class="preset-sub">'+p.sub+'</div>';
    btn.onclick = function() { applyPreset(key); };
    g.appendChild(btn);
  });
}

function applyPreset(key) {
  currentPreset = key;
  var p = PRESETS[key];
  Object.keys(p).forEach(function(k) {
    if(k==='label'||k==='sub') return;
    CFG[k] = p[k];
  });
  updateAllUI();
  renderPresets();
  var descs = {
    lotto645:'í•œêµ­ ë¡œë˜ 6/45 ìµœì í™” ì„¤ì •. items=45, pick=6, rounds=50',
    lotto638:'6/38 ë³µê¶Œ ìµœì í™”. ë²”ìœ„ê°€ ì¢ì•„ ë¹ ë¥¸ ìˆ˜ë ´',
    powerball:'ë¯¸êµ­ íŒŒì›Œë³¼ 5/69 ì„¤ì •. ë²”ìœ„ê°€ ë„“ì–´ ë” ë§ì€ ë¼ìš´ë“œ í•„ìš”',
    megamillions:'ë©”ê°€ë°€ë¦¬ì–¸ 5/70 ì„¤ì •',
    euromillions:'ìœ ëŸ½ ìœ ë¡œë°€ë¦¬ì–¸ 5/50 ì„¤ì •',
    keno:'ì¼€ë…¸ 80ì¤‘ 20 ì„¤ì •. ë§ì€ ê°œìˆ˜ ì„ íƒìœ¼ë¡œ evolveTime ì¦ê°€',
    turbo:'ë¹ ë¥¸ ì‹¤í–‰ ëª¨ë“œ. ì •ë°€ë„â†“ ì†ë„â†‘. ì‹¤ì‹œê°„ ì¶”ì²œì— ì í•©',
    custom:'ëª¨ë“  íŒŒë¼ë¯¸í„°ë¥¼ ì§ì ‘ ì„¤ì •í•˜ëŠ” ì»¤ìŠ¤í…€ ëª¨ë“œ'
  };
  document.getElementById('presetDesc').textContent = descs[key] || '';
}

// â•â• ìŠ¬ë¼ì´ë” ë™ê¸°í™” â•â•
function syncOpt(key, val, isFloat) {
  CFG[key] = isFloat ? parseFloat(val) : parseInt(val);
  document.getElementById('v_'+key).textContent = isFloat ? parseFloat(val).toFixed(2) : val;
  updateSummary();
  if(currentPreset !== 'custom') { currentPreset = 'custom'; renderPresets(); }
}

function updateAllUI() {
  var sliders = ['items','pick','rounds','poolSize','topN','evolveTime','recentWindow'];
  sliders.forEach(function(k) {
    var el = document.getElementById('s_'+k);
    var vl = document.getElementById('v_'+k);
    if(el && CFG[k]!==undefined) { el.value = CFG[k]; vl.textContent = CFG[k]; }
  });
  var floats = ['statWeight','bonusWeight','colorZoneWeight','persistenceWeight'];
  floats.forEach(function(k) {
    var el = document.getElementById('s_'+k);
    var vl = document.getElementById('v_'+k);
    if(el && CFG[k]!==undefined) {
      el.value = Math.round(CFG[k]*100);
      vl.textContent = CFG[k].toFixed(2);
    }
  });
  updateSummary();
}

function updateSummary() {
  document.getElementById('sumItems').textContent = CFG.items;
  document.getElementById('sumPick').textContent = CFG.pick;
  document.getElementById('sumRounds').textContent = CFG.rounds;
  document.getElementById('sumPool').textContent = (CFG.poolSize||0).toLocaleString();
  document.getElementById('sumTopN').textContent = CFG.topN;
  document.getElementById('sumEvolve').textContent = (CFG.evolveTime||80)+'ms';
}

// â•â• ì½”ë“œ ìƒì„± â•â•
function generateCode() {
  var col = document.getElementById('fb_col').value || 'lotto_history';
  var doc = document.getElementById('fb_doc').value || 'shared_engine_state';
  var code =
'// CubeEngine ì„¤ì • â€” ' + new Date().toLocaleDateString('ko-KR') + '\n' +
'// í”„ë¦¬ì…‹: ' + currentPreset + '\n\n' +
'const result = await CubeEngine.generate(\n' +
'  CubeEngine.withPreset(\'' + (currentPreset==='custom'?'lotto645':currentPreset) + '\', {\n' +
'    items           : ' + CFG.items + ',\n' +
'    pick            : ' + CFG.pick + ',\n' +
'    rounds          : ' + CFG.rounds + ',\n' +
'    poolSize        : ' + CFG.poolSize + ',\n' +
'    topN            : ' + CFG.topN + ',\n' +
'    evolveTime      : ' + CFG.evolveTime + ',\n' +
'    statWeight      : ' + CFG.statWeight.toFixed(2) + ',\n' +
'    recentWindow    : ' + CFG.recentWindow + ',\n' +
'    bonusWeight     : ' + CFG.bonusWeight.toFixed(2) + ',\n' +
'    colorZoneWeight : ' + CFG.colorZoneWeight.toFixed(2) + ',\n' +
'    persistenceWeight: ' + CFG.persistenceWeight.toFixed(2) + ',\n' +
(CFG.rangeStart&&CFG.rangeStart>1 ? '    rangeStart      : ' + CFG.rangeStart + ',\n' : '') +
(CFG.rangeEnd&&CFG.rangeEnd<CFG.items ? '    rangeEnd        : ' + CFG.rangeEnd + ',\n' : '') +
'    history         : ë‹¹ì²¨ë²ˆí˜¸_ë°°ì—´,   // [[n1,n2,...], ...]\n' +
'    bonusHistory    : ë³´ë„ˆìŠ¤ë²ˆí˜¸_ë°°ì—´, // [b1, b2, ...]\n' +
'    externalProbMap : prevProbMap,     // Firebaseì—ì„œ ë¡œë“œí•œ ì´ì „ í™•ë¥ ë§µ\n' +
'    initialPool     : prevPool,        // Firebaseì—ì„œ ë¡œë“œí•œ ì´ì „ pool\n' +
'    onProgress      : function(pct, stats) { console.log(pct + \'%\'); }\n' +
'  })\n' +
');\n\n' +
'// Firebase ì €ì¥ ê²½ë¡œ\n' +
'// Collection: ' + col + '\n' +
'// Document  : ' + doc + '\n' +
'// probMap í‚¤ í˜•ì‹: n1~n45';
  document.getElementById('generatedCode').textContent = code;
}

function copyCode() {
  var code = document.getElementById('generatedCode').textContent;
  navigator.clipboard.writeText(code).then(function(){
    var btn = event.target;
    btn.textContent = 'âœ… ë³µì‚¬ë¨!';
    setTimeout(function(){ btn.textContent = 'ğŸ“‹ ì½”ë“œ ë³µì‚¬'; }, 2000);
  });
}

// â•â• ì„¤ì • ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° â•â•
function saveSettings() {
  try {
    localStorage.setItem('cubeengine_cfg', JSON.stringify(CFG));
    localStorage.setItem('cubeengine_preset', currentPreset);
    localStorage.setItem('cubeengine_fb', JSON.stringify({
      col: document.getElementById('fb_col').value,
      doc: document.getElementById('fb_doc').value,
      btdoc: document.getElementById('fb_btdoc').value,
      history: document.getElementById('fb_history').value
    }));
    rlog('ğŸ’¾ ì„¤ì • ì €ì¥ ì™„ë£Œ (LocalStorage)', 'log-ts');
  } catch(e) { rlog('ì €ì¥ ì‹¤íŒ¨: '+e.message, 'log-te'); }
}

function loadSettings() {
  try {
    var cfg = localStorage.getItem('cubeengine_cfg');
    var preset = localStorage.getItem('cubeengine_preset');
    var fb = localStorage.getItem('cubeengine_fb');
    if(cfg) {
      CFG = JSON.parse(cfg);
      currentPreset = preset || 'custom';
      updateAllUI(); renderPresets();
      rlog('ğŸ“‚ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ', 'log-ts');
    }
    if(fb) {
      var f = JSON.parse(fb);
      document.getElementById('fb_col').value = f.col||'';
      document.getElementById('fb_doc').value = f.doc||'';
      document.getElementById('fb_btdoc').value = f.btdoc||'';
      document.getElementById('fb_history').value = f.history||'';
    }
  } catch(e) { rlog('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: '+e.message, 'log-te'); }
}

function resetSettings() {
  if(!confirm('ëª¨ë“  ì„¤ì •ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•©ë‹ˆê¹Œ?')) return;
  applyPreset('lotto645');
  rlog('â†º ê¸°ë³¸ê°’(lotto645)ìœ¼ë¡œ ì´ˆê¸°í™”', 'log-tw');
}

// â•â• ë¡œê·¸ â•â•
function rlog(msg, cls) {
  var el = document.getElementById('runLog');
  var d = document.createElement('div');
  d.className = cls||'log-ti';
  d.textContent = '['+new Date().toLocaleTimeString('ko-KR')+'] '+msg;
  el.insertBefore(d, el.firstChild);
}

// â•â• í…ŒìŠ¤íŠ¸ ì‹¤í–‰ â•â•
async function runTest() {
  if(typeof CubeEngine === 'undefined') {
    rlog('âŒ cube-engine.js ë¡œë“œ ì‹¤íŒ¨ â€” ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”', 'log-te');
    return;
  }
  document.getElementById('btnTest').disabled = true;
  document.getElementById('runStatus').className = 'badge badge-warn';
  document.getElementById('runStatus').textContent = 'ì‹¤í–‰ ì¤‘...';
  document.getElementById('runBar').style.width = '0%';
  document.getElementById('runBest').textContent = '-';

  rlog('â–¶ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ â€” í”„ë¦¬ì…‹: '+currentPreset+' | rounds:'+CFG.rounds+' | poolSize:'+CFG.poolSize, 'log-ts');

  try {
    var opts = Object.assign({}, CFG, {
      topN: CFG.topN,
      onProgress: function(pct, stats) {
        document.getElementById('runBar').style.width = pct+'%';
        if(stats && stats.bestScore && stats.bestScore > 0) {
          document.getElementById('runBest').textContent = stats.bestScore.toFixed(2);
        }
        if(stats && stats.round && stats.round % 5 === 0) {
          rlog('Round '+stats.round+'/'+CFG.rounds+' â€” best:'+(stats.bestScore||0).toFixed(2), 'log-ti');
        }
      }
    });
    if(!opts.rangeStart || opts.rangeStart <= 1) delete opts.rangeStart;
    if(!opts.rangeEnd || opts.rangeEnd >= opts.items) delete opts.rangeEnd;

    var result = await CubeEngine.generate(opts);

    document.getElementById('runStatus').className = 'badge badge-ok';
    document.getElementById('runStatus').textContent = 'ì™„ë£Œ';
    document.getElementById('runBar').style.width = '100%';
    document.getElementById('runBest').textContent = result.scores[0].toFixed(2);

    rlog('âœ… ì™„ë£Œ â€” best:'+result.scores[0].toFixed(2)+' | elapsed:'+result.meta.elapsed+'ms', 'log-ts');
    result.results.slice(0,3).forEach(function(combo, i){
      rlog('#'+(i+1)+': ['+combo.join(', ')+'] ì ìˆ˜:'+result.scores[i].toFixed(2), 'log-ti');
    });
  } catch(e) {
    document.getElementById('runStatus').className = 'badge badge-err';
    document.getElementById('runStatus').textContent = 'ì˜¤ë¥˜';
    rlog('âŒ ì˜¤ë¥˜: '+e.message, 'log-te');
  } finally {
    document.getElementById('btnTest').disabled = false;
  }
}

// â•â• ì´ˆê¸°í™” â•â•
(function init() {
  renderPresets();
  updateAllUI();
  loadSettings();
  generateCode();

  // ì½”ë“œ ìë™ ê°±ì‹ 
  document.querySelectorAll('input[type=range], input[type=number], .fb-input').forEach(function(el){
    el.addEventListener('change', function(){ if(document.getElementById('tab-code').classList.contains('active')) generateCode(); });
  });

  // CubeEngine ë¡œë“œ í™•ì¸
  if(typeof CubeEngine !== 'undefined') {
    rlog('âœ… CubeEngine v'+CubeEngine.version+' ë¡œë“œ ì™„ë£Œ', 'log-ts');
  } else {
    rlog('âš ï¸ CubeEngine ë¯¸ë¡œë“œ â€” cube-engine.jsë¥¼ ê°™ì€ í´ë”ì— ë†“ì•„ì£¼ì„¸ìš”', 'log-tw');
  }
})();
</script>
</body>
</html>
